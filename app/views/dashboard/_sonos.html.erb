<div class="sonos">
	<div class="sonos_album-art"> <img height="100%" id="album_art" src="data:image/jpeg;base64,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"></div>
	<div class="sonos_meta">
		<div class="sonos_track" id="track">Brothers in Arms</div>
		<div class="sonos_artist" id="artist">Dire Straits</div>
	</div>
	<div class="sonos_controls">
		<i class="fas fa-backward sonos_arrow" onClick="sonosAction('previous')"></i>
		<i id="player_toggle" class="far fa-play-circle sonos_pause" onClick="togglePlay()"></i>
		<i class="fas fa-forward sonos_arrow" onClick="sonosAction('next')"></i>
	</div>
</div>

<script>
  let player_state = 'PAUSED';

  togglePlay = function() {
  	console.log('player_state')
  	if (player_state == 'PAUSED') {
  		sonosAction('play');
  		document.getElementById('player_toggle').className = "far fa-pause-circle sonos_pause"
  		player_state = 'PLAYING';
  	} else {
  		sonosAction('pause');
  		document.getElementById('player_toggle').className = "far fa-play-circle sonos_pause"
  		player_state = 'PAUSED';
  	}
  }

  const updatePlaying = function() {
	  fetch('/whats_playing')
	  .then(
	    function(response) {
	      if (response.status !== 200) {
	        console.log('Looks like there was a problem. Status Code: ' +
	          response.status);
	        return;
	      }

	      // Examine the text in the response
	      response.json().then(function(data) {
	        console.log(data);
	        console.log(data.track);
	        document.getElementById('album_art').src = data.url;
	        document.getElementById('artist').innerHTML = data.artist;
	        document.getElementById('track').innerHTML = data.track;

	        player_state = data.state;
	        if (player_state == 'PAUSED') {
  		
  		document.getElementById('player_toggle').className = "far fa-play-circle sonos_pause"

  	} else {
  		console.log('state' + data.state)
  		document.getElementById('player_toggle').className = "far fa-pause-circle sonos_pause"

  	}
	      });
	    }
	  )
	  .catch(function(err) {
	    console.log('Fetch Error :-S', err);
	  });
  };

  const sonosAction = function(action) {
  	fetch("/whats_playing?to_do="+action, { method: 'PUT'})
  .then(
    function(response) {
      if (response.status !== 200) {
        console.log('Looks like there was a problem. Status Code: ' +
          response.status);
        return;
      }

      // Examine the text in the response
      response.json().then(function(data) {
        console.log(data);
      });
    }
  )
  .catch(function(err) {
    console.log('Fetch Error :-S', err);
  });
  }

  updatePlaying();
  setInterval(function() { updatePlaying() }, 3000);
</script>